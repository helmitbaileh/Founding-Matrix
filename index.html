<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Startup Equity Matrix | Strict Max 10</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Inter:wght@400;700;900&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        --bg-color: #ffffff;
        --main-color: #000000;
        --accent-color: #2563eb;
        --money-color: #059669;
      }
      body {
        font-family: "Inter", sans-serif;
        background-color: var(--bg-color);
        color: var(--main-color);
      }
      .brutalist-border {
        border: 3px solid var(--main-color);
      }
      .brutalist-input {
        border: 2px solid var(--main-color);
        border-radius: 0;
        padding: 10px;
        font-weight: bold;
        width: 100%;
        outline: none;
        font-family: "JetBrains Mono", monospace;
      }
      .brutalist-input:focus {
        background-color: #e0f2fe;
        border-color: var(--accent-color);
      }
      .cash-input:focus {
        background-color: #d1fae5;
        border-color: var(--money-color);
      }
      .brutalist-btn {
        background: var(--main-color);
        color: white;
        border: none;
        padding: 12px 24px;
        font-weight: 800;
        cursor: pointer;
        text-transform: uppercase;
        letter-spacing: 1px;
      }
      .brutalist-btn:hover {
        background: var(--accent-color);
      }
      .brutalist-btn.secondary {
        background: white;
        color: black;
        border: 3px solid black;
      }
      .brutalist-btn.danger {
        background: white;
        color: #dc2626;
        border: 2px solid #dc2626;
        padding: 4px 8px;
        font-size: 0.8rem;
      }
      table {
        border-collapse: separate;
        border-spacing: 0;
        width: 100%;
      }
      th,
      td {
        border: 1px solid var(--main-color);
        padding: 8px;
        text-align: center;
      }
      th {
        background-color: #f3f4f6;
        text-transform: uppercase;
        border-bottom: 3px solid black;
        font-size: 0.85rem;
      }
      input[type="number"]::-webkit-inner-spin-button {
        -webkit-appearance: none;
        margin: 0;
      }
    </style>
  </head>
  <body class="p-6 md:p-12 max-w-[1600px] mx-auto">
    <header
      class="border-b-4 border-black pb-6 mb-10 flex flex-col md:flex-row justify-between items-end gap-4"
    >
      <div>
        <h1 class="text-4xl md:text-6xl font-black uppercase tracking-tighter">
          Founding Matrix
        </h1>
        <p class="text-lg font-bold mt-2 text-gray-600">
          Weighted Scoring System (Strict Max 10)
        </p>
      </div>
    </header>

    <div class="grid grid-cols-1 xl:grid-cols-4 gap-8">
      <div class="xl:col-span-1 space-y-6">
        <div class="brutalist-border p-6 bg-green-50">
          <h2 class="text-xl font-black mb-6 uppercase flex items-center gap-2">
            <span
              class="bg-green-600 text-white w-8 h-8 flex items-center justify-center text-lg"
              >₪</span
            >
            Global Split
          </h2>
          <div class="mb-4">
            <label class="block text-sm font-bold mb-2 uppercase"
              >Cash Weight (0-100%)</label
            >
            <div class="flex items-center gap-2">
              <input
                type="number"
                id="capitalWeight"
                value="30"
                oninput="updateCalculationsOnly()"
                class="brutalist-input text-green-700 text-2xl text-center"
              />
              <span class="font-black text-2xl">%</span>
            </div>
          </div>
          <div class="border-t-2 border-black my-4 border-dashed"></div>
          <div>
            <label class="block text-sm font-bold mb-2 uppercase"
              >Skills Weight</label
            >
            <div class="flex items-center gap-2">
              <input
                type="number"
                id="skillsWeight"
                value="70"
                readonly
                class="brutalist-input bg-gray-200 text-gray-500 text-2xl text-center cursor-not-allowed"
              />
              <span class="font-black text-2xl">%</span>
            </div>
          </div>
        </div>

        <div class="brutalist-border p-6 bg-white">
          <h2 class="text-xl font-black mb-4 uppercase">
            Factor Weights (Max 10)
          </h2>

          <div id="factorsList" class="space-y-3 mb-6"></div>
          <button onclick="addFactor()" class="w-full brutalist-btn text-sm">
            + Add Skill Factor
          </button>
        </div>

        <div class="bg-black text-white p-6 font-mono text-center shadow-lg">
          <p class="text-xs text-gray-400 uppercase tracking-widest mb-1">
            Total Capital (ILS)
          </p>
          <p id="totalCashDisplay" class="text-4xl font-bold text-green-400">
            ₪0
          </p>
        </div>
      </div>

      <div class="xl:col-span-3 space-y-8">
        <div
          class="overflow-x-auto brutalist-border p-1 bg-white shadow-[8px_8px_0px_0px_rgba(0,0,0,1)]"
        >
          <table class="w-full min-w-[900px]">
            <thead>
              <tr id="tableHeaderRow"></tr>
            </thead>
            <tbody id="matrixBody"></tbody>
          </table>
        </div>

        <button
          onclick="addPartner()"
          class="brutalist-btn secondary w-full md:w-auto font-bold"
        >
          + Add Partner
        </button>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mt-4">
          <div class="brutalist-border p-6 bg-blue-50">
            <h3
              class="font-black text-xl mb-6 underline decoration-4 decoration-blue-600 uppercase text-blue-800"
            >
              Final Equity Split
            </h3>
            <div id="barsContainer" class="space-y-6"></div>
          </div>

          <div class="brutalist-border p-6 bg-gray-50">
            <h3 class="font-black text-xl mb-6 uppercase">Calculation Logic</h3>
            <ul
              class="text-sm space-y-3 list-disc list-inside font-mono text-gray-700"
            >
              <li>
                <span class="font-bold">Normalization:</span> Points are
                normalized against the total pool to ensure a perfect 100%
                split.
              </li>
              <li>
                <span class="font-bold">Strict Validation:</span> All inputs are
                capped at 10 to prevent skewing the matrix.
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>

    <script>
      let config = { capitalWeight: 30 };
      let factors = [
        { id: "f1", name: "Odoo Coding", weight: 10 },
        { id: "f2", name: "Strategic Planning", weight: 7 },
        { id: "f3", name: "PR & Networking", weight: 8 },
      ];
      let partners = [
        {
          id: "p1",
          name: "Partner 1",
          cash: 2000,
          scores: { f1: 10, f2: 10, f3: 10 },
        },
        {
          id: "p2",
          name: "Partner 2",
          cash: 5000,
          scores: { f1: 8, f2: 4, f3: 2 },
        },
      ];

      function init() {
        renderFactorsList();
        rebuildTableStructure();
        updateCalculationsOnly();
      }

      function updateCalculationsOnly() {
        let capVal =
          parseFloat(document.getElementById("capitalWeight").value) || 0;
        if (capVal > 100) capVal = 100;
        config.capitalWeight = capVal;
        const skillWeight = 100 - capVal;
        document.getElementById("skillsWeight").value = skillWeight;

        let totalCash = partners.reduce((sum, p) => sum + (p.cash || 0), 0);
        document.getElementById("totalCashDisplay").innerText =
          "₪" + totalCash.toLocaleString();

        let partnersRawSkillTotal = {};
        let grandTotalSkillPoints = 0;

        partners.forEach((p) => {
          let pSkillSum = 0;
          factors.forEach((f) => {
            let s = p.scores[f.id] || 0;
            if (s > 10) s = 10; // Extra safety in logic
            pSkillSum += s * (f.weight || 1);
          });
          partnersRawSkillTotal[p.id] = pSkillSum;
          grandTotalSkillPoints += pSkillSum;
        });

        partners.forEach((p) => {
          let cashShare = totalCash > 0 ? p.cash / totalCash : 0;
          let finalCashPoints = cashShare * config.capitalWeight;
          let skillShare =
            grandTotalSkillPoints > 0
              ? partnersRawSkillTotal[p.id] / grandTotalSkillPoints
              : 0;
          let finalSkillPoints = skillShare * skillWeight;
          let finalEquity = finalCashPoints + finalSkillPoints;

          document.getElementById(`res-cash-${p.id}`).innerText =
            finalCashPoints.toFixed(1);
          document.getElementById(`res-skill-${p.id}`).innerText =
            finalSkillPoints.toFixed(1);
          document.getElementById(`res-equity-${p.id}`).innerText =
            finalEquity.toFixed(1) + "%";
        });

        updateBars(
          partners,
          totalCash,
          partnersRawSkillTotal,
          grandTotalSkillPoints,
          skillWeight
        );
      }

      function updateBars(
        partners,
        totalCash,
        skillTotals,
        grandSkillTotal,
        skillWeight
      ) {
        const container = document.getElementById("barsContainer");
        container.innerHTML = partners
          .map((p) => {
            let cashShare = totalCash > 0 ? p.cash / totalCash : 0;
            let skillShare =
              grandSkillTotal > 0 ? skillTotals[p.id] / grandSkillTotal : 0;
            let cp = cashShare * config.capitalWeight;
            let sp = skillShare * skillWeight;
            return `
                    <div>
                        <div class="flex justify-between text-sm font-bold mb-1 font-mono">
                            <span>${p.name}</span>
                            <span class="text-blue-700">${(cp + sp).toFixed(
                              1
                            )}%</span>
                        </div>
                        <div class="w-full border-2 border-black h-6 flex bg-gray-100">
                            <div class="bg-green-500 h-full" style="width: ${cp.toFixed(
                              2
                            )}%"></div>
                            <div class="bg-black h-full" style="width: ${sp.toFixed(
                              2
                            )}%"></div>
                        </div>
                    </div>
                `;
          })
          .join("");
      }

      function rebuildTableStructure() {
        const headerRow = document.getElementById("tableHeaderRow");
        const tbody = document.getElementById("matrixBody");
        let headerHTML = `<th class="w-48 bg-black text-white px-4 text-left">Founder</th>
                              <th class="w-40 bg-green-50 text-green-900 border-green-800">Capital (₪)</th>`;
        factors.forEach((f) => {
          headerHTML += `<th class="w-24 text-sm">${f.name}<br><span class="text-[9px] text-gray-500">Weight: ${f.weight}</span></th>`;
        });
        headerHTML += `<th class="w-24 bg-gray-100 text-xs">Cash Pts</th>
                           <th class="w-24 bg-gray-100 text-xs">Skill Pts</th>
                           <th class="w-32 bg-blue-600 text-white text-lg">Total %</th>
                           <th class="w-12"></th>`;
        headerRow.innerHTML = headerHTML;

        tbody.innerHTML = partners
          .map((p) => {
            const skillInputs = factors
              .map(
                (f) => `
                    <td class="p-1"><input type="number" min="0" max="10" step="0.5" value="${
                      p.scores[f.id] || 0
                    }" 
                    oninput="handleSkillInput('${p.id}', '${
                  f.id
                }', this.value)" class="brutalist-input text-center h-full border-gray-300 focus:border-black text-sm"></td>
                `
              )
              .join("");

            return `<tr>
                        <td class="p-1"><input type="text" value="${p.name}" oninput="handleNameInput('${p.id}', this.value)" class="brutalist-input border-0 bg-transparent h-full font-bold"></td>
                        <td class="p-1 bg-green-50"><input type="number" value="${p.cash}" oninput="handleCashInput('${p.id}', this.value)" class="cash-input brutalist-input text-center h-full bg-transparent"></td>
                        ${skillInputs}
                        <td class="bg-gray-50 font-mono font-bold text-gray-500 text-sm" id="res-cash-${p.id}">0</td>
                        <td class="bg-gray-50 font-mono font-bold text-gray-500 text-sm" id="res-skill-${p.id}">0</td>
                        <td class="bg-blue-600 text-white font-black text-xl font-mono" id="res-equity-${p.id}">0%</td>
                        <td class="text-center"><button onclick="removePartner('${p.id}')" class="brutalist-btn danger">X</button></td>
                    </tr>`;
          })
          .join("");
      }

      function renderFactorsList() {
        const container = document.getElementById("factorsList");
        container.innerHTML = factors
          .map(
            (f) => `
                <div class="flex gap-2 items-center">
                    <button onclick="removeFactor('${f.id}')" class="text-red-600 font-bold px-2 border border-red-200">✕</button>
                    <input type="text" value="${f.name}" onchange="updateFactorData('${f.id}', 'name', this.value)" class="brutalist-input text-sm py-2 border-gray-300">
                    <input type="number" min="1" max="10" value="${f.weight}" oninput="updateFactorData('${f.id}', 'weight', this.value)" class="brutalist-input w-20 text-center text-sm py-2 bg-gray-100 font-mono">
                </div>
            `
          )
          .join("");
      }

      function handleNameInput(id, val) {
        partners.find((x) => x.id === id).name = val;
        updateCalculationsOnly();
      }
      function handleCashInput(id, val) {
        partners.find((x) => x.id === id).cash = parseFloat(val) || 0;
        updateCalculationsOnly();
      }

      function handleSkillInput(pId, fId, val) {
        let num = parseFloat(val);
        if (num > 10) {
          num = 10;
          // Force UI update to 10
          event.target.value = 10;
        }
        partners.find((x) => x.id === pId).scores[fId] = num || 0;
        updateCalculationsOnly();
      }

      function updateFactorData(id, field, val) {
        const f = factors.find((x) => x.id === id);
        if (field === "weight") {
          let num = parseFloat(val);
          if (num > 10) {
            num = 10;
            event.target.value = 10;
          }
          f.weight = num || 0;
        }
        if (field === "name") f.name = val;
        rebuildTableStructure();
        updateCalculationsOnly();
      }

      function addFactor() {
        const id = "f" + Date.now();
        factors.push({ id, name: "New Factor", weight: 5 });
        partners.forEach((p) => (p.scores[id] = 0));
        renderFactorsList();
        rebuildTableStructure();
        updateCalculationsOnly();
      }

      function removeFactor(id) {
        factors = factors.filter((f) => f.id !== id);
        renderFactorsList();
        rebuildTableStructure();
        updateCalculationsOnly();
      }

      function addPartner() {
        const id = "p" + Date.now();
        const scores = {};
        factors.forEach((f) => (scores[f.id] = 0));
        partners.push({ id, name: "Founder", cash: 0, scores });
        rebuildTableStructure();
        updateCalculationsOnly();
      }

      function removePartner(id) {
        partners = partners.filter((p) => p.id !== id);
        rebuildTableStructure();
        updateCalculationsOnly();
      }

      init();
    </script>
  </body>
</html>
