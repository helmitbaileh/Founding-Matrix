<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Startup Equity Matrix</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Inter:wght@400;700;900&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        --bg-color: #ffffff;
        --main-color: #000000;
        --accent-color: #2563eb; /* Royal Blue */
        --money-color: #059669; /* Emerald Green */
      }
      body {
        font-family: "Inter", sans-serif;
        background-color: var(--bg-color);
        color: var(--main-color);
      }
      /* Brutalist Styles */
      .brutalist-border {
        border: 3px solid var(--main-color);
      }

      .brutalist-input {
        border: 2px solid var(--main-color);
        border-radius: 0;
        padding: 10px;
        font-weight: bold;
        width: 100%;
        outline: none;
        font-family: "JetBrains Mono", monospace;
        transition: background 0.2s;
      }

      .brutalist-input:focus {
        background-color: #e0f2fe; /* Light Blue focus */
        border-color: var(--accent-color);
      }

      /* Specific style for Cash Input */
      .cash-input:focus {
        background-color: #d1fae5; /* Light Green focus */
        border-color: var(--money-color);
      }

      .brutalist-btn {
        background: var(--main-color);
        color: white;
        border: none;
        padding: 12px 24px;
        font-weight: 800;
        cursor: pointer;
        text-transform: uppercase;
        letter-spacing: 1px;
      }
      .brutalist-btn:hover {
        background: var(--accent-color);
      }
      .brutalist-btn.secondary {
        background: white;
        color: black;
        border: 3px solid black;
      }
      .brutalist-btn.secondary:hover {
        background: #f3f4f6;
      }
      .brutalist-btn.danger {
        background: white;
        color: #dc2626;
        border: 2px solid #dc2626;
        padding: 4px 8px;
        font-size: 0.8rem;
      }
      .brutalist-btn.danger:hover {
        background: #fee2e2;
      }

      table {
        border-collapse: separate;
        border-spacing: 0;
        width: 100%;
      }
      th,
      td {
        border: 1px solid var(--main-color);
        padding: 8px;
        text-align: center;
      }
      th {
        background-color: #f3f4f6;
        text-transform: uppercase;
        border-bottom: 3px solid black;
        font-size: 0.85rem;
      }

      /* Remove number spinners for cleaner look, but allow functionality */
      input[type="number"]::-webkit-inner-spin-button,
      input[type="number"]::-webkit-outer-spin-button {
        -webkit-appearance: none;
        margin: 0;
      }
    </style>
  </head>
  <body class="p-6 md:p-12 max-w-[1600px] mx-auto">
    <header
      class="border-b-4 border-black pb-6 mb-10 flex flex-col md:flex-row justify-between items-end gap-4"
    >
      <div>
        <h1 class="text-4xl md:text-6xl font-black uppercase tracking-tighter">
          Founding Matrix
        </h1>
        <p class="text-lg font-bold mt-2 text-gray-600">
          Dynamic Equity Calculator (Capital + Skills)
        </p>
      </div>
    </header>

    <div class="grid grid-cols-1 xl:grid-cols-4 gap-8">
      <div class="xl:col-span-1 space-y-6">
        <div class="brutalist-border p-6 bg-green-50">
          <h2 class="text-xl font-black mb-6 flex items-center gap-2 uppercase">
            <span
              class="bg-green-600 text-white w-8 h-8 flex items-center justify-center text-lg"
              >$</span
            >
            Weighting
          </h2>

          <div class="mb-6">
            <label class="block text-sm font-bold mb-2 uppercase"
              >Cash Weight</label
            >
            <div class="flex items-center gap-2">
              <input
                type="number"
                id="capitalWeight"
                value="30"
                oninput="updateCalculationsOnly()"
                class="brutalist-input text-green-700 text-2xl text-center"
              />
              <span class="font-black text-2xl">%</span>
            </div>
            <p class="text-xs text-gray-500 mt-2 font-mono">
              How much cash matters
            </p>
          </div>

          <div class="border-t-2 border-black my-4 border-dashed"></div>

          <div>
            <label class="block text-sm font-bold mb-2 uppercase"
              >Skills Weight</label
            >
            <div class="flex items-center gap-2">
              <input
                type="number"
                id="skillsWeight"
                value="70"
                readonly
                class="brutalist-input bg-gray-200 text-gray-500 text-2xl text-center cursor-not-allowed"
              />
              <span class="font-black text-2xl">%</span>
            </div>
            <p class="text-xs text-gray-500 mt-2 font-mono">
              Auto-calculated (100 - Cash)
            </p>
          </div>
        </div>

        <div class="brutalist-border p-6 bg-white">
          <h2 class="text-xl font-black mb-4 uppercase">Skill Factors</h2>
          <div id="factorsList" class="space-y-3 mb-4"></div>
          <button onclick="addFactor()" class="w-full brutalist-btn text-sm">
            + Add Skill Factor
          </button>
        </div>

        <div class="bg-black text-white p-6 font-mono text-center shadow-lg">
          <p class="text-xs text-gray-400 uppercase tracking-widest mb-1">
            Total Capital Raised
          </p>
          <p id="totalCashDisplay" class="text-4xl font-bold text-green-400">
            $0
          </p>
        </div>
      </div>

      <div class="xl:col-span-3 space-y-8">
        <div
          class="overflow-x-auto brutalist-border p-1 bg-white shadow-[8px_8px_0px_0px_rgba(0,0,0,1)]"
        >
          <table class="w-full min-w-[900px]">
            <thead>
              <tr id="tableHeaderRow"></tr>
            </thead>
            <tbody id="matrixBody"></tbody>
          </table>
        </div>

        <button
          onclick="addPartner()"
          class="brutalist-btn secondary w-full md:w-auto font-bold"
        >
          + Add Partner
        </button>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mt-4">
          <div class="brutalist-border p-6 bg-blue-50">
            <h3
              class="font-black text-xl mb-6 underline decoration-4 decoration-blue-600 uppercase"
            >
              Final Equity Split
            </h3>
            <div id="barsContainer" class="space-y-6"></div>
          </div>

          <div class="brutalist-border p-6 bg-gray-50">
            <h3 class="font-black text-xl mb-6 uppercase">The Math Logic</h3>
            <ul
              class="text-sm space-y-3 list-disc list-inside font-mono text-gray-700"
            >
              <li>
                <span class="font-bold">Cash Score:</span> (Partner Cash / Total
                Cash) × <span id="mathCashW">30</span>
              </li>
              <li>
                <span class="font-bold">Skill Score:</span> (Partner Points /
                Total Points) × <span id="mathSkillW">70</span>
              </li>
              <li>
                <span class="font-bold">Total Equity:</span> Cash Score + Skill
                Score
              </li>
            </ul>
            <div
              class="mt-6 p-4 bg-yellow-100 border border-yellow-500 text-xs font-bold"
            >
              NOTE: Skill scores are rated 0-10 relative to each factor's
              internal weight.
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      // --- State Data ---
      let config = {
        capitalWeight: 30,
      };

      // Factors: Internal weight determines importance of that skill
      let factors = [
        { id: "f1", name: "Idea & Setup", weight: 20 },
        { id: "f2", name: "Commitment (Time)", weight: 40 },
        { id: "f3", name: "Technical Skills", weight: 40 },
      ];

      let partners = [
        {
          id: "p1",
          name: "Helmy",
          cash: 2000,
          scores: { f1: 10, f2: 10, f3: 10 },
        },
        {
          id: "p2",
          name: "Partner 2",
          cash: 5000,
          scores: { f1: 2, f2: 5, f3: 0 },
        },
        {
          id: "p3",
          name: "Partner 3",
          cash: 0,
          scores: { f1: 5, f2: 8, f3: 5 },
        },
        {
          id: "p4",
          name: "Partner 4",
          cash: 1000,
          scores: { f1: 0, f2: 6, f3: 2 },
        },
      ];

      // --- Core Functions ---

      function init() {
        renderFactorsList();
        rebuildTableStructure(); // Run once to build DOM
        updateCalculationsOnly(); // Run logic
      }

      // --- 1. Configuration & Weights ---
      function updateCalculationsOnly() {
        // Update Config from Input
        let capVal = parseFloat(document.getElementById("capitalWeight").value);
        if (isNaN(capVal)) capVal = 0;
        if (capVal > 100) capVal = 100;

        config.capitalWeight = capVal;
        const skillWeight = 100 - capVal;
        document.getElementById("skillsWeight").value = skillWeight;

        // Update Text Labels
        document.getElementById("mathCashW").innerText = config.capitalWeight;
        document.getElementById("mathSkillW").innerText = skillWeight;
        const hCash = document.getElementById("headerCashPts");
        const hSkill = document.getElementById("headerSkillPts");
        if (hCash) hCash.innerText = `Max: ${config.capitalWeight}`;
        if (hSkill) hSkill.innerText = `Max: ${skillWeight}`;

        // --- THE MATH ---

        // 1. Total Cash
        let totalCash = partners.reduce((sum, p) => sum + (p.cash || 0), 0);
        document.getElementById("totalCashDisplay").innerText =
          "$" + totalCash.toLocaleString();

        // 2. Skill Points Calculations
        let partnersRawSkillTotal = {};
        let grandTotalSkillPoints = 0;

        partners.forEach((p) => {
          let pSkillSum = 0;
          factors.forEach((f) => {
            pSkillSum += (p.scores[f.id] || 0) * f.weight;
          });
          partnersRawSkillTotal[p.id] = pSkillSum;
          grandTotalSkillPoints += pSkillSum;
        });

        // 3. Update Results in DOM (WITHOUT Re-rendering Inputs)
        partners.forEach((p) => {
          let cashShare = totalCash > 0 ? p.cash / totalCash : 0;
          let finalCashPoints = cashShare * config.capitalWeight;

          let skillShare =
            grandTotalSkillPoints > 0
              ? partnersRawSkillTotal[p.id] / grandTotalSkillPoints
              : 0;
          let finalSkillPoints = skillShare * skillWeight;

          let finalEquity = finalCashPoints + finalSkillPoints;

          // Update text cells by ID
          const cashCell = document.getElementById(`res-cash-${p.id}`);
          const skillCell = document.getElementById(`res-skill-${p.id}`);
          const eqCell = document.getElementById(`res-equity-${p.id}`);

          if (cashCell) cashCell.innerText = finalCashPoints.toFixed(1);
          if (skillCell) skillCell.innerText = finalSkillPoints.toFixed(1);
          if (eqCell) eqCell.innerText = finalEquity.toFixed(1) + "%";
        });

        // 4. Update Bars
        updateBars(
          partners,
          totalCash,
          partnersRawSkillTotal,
          grandTotalSkillPoints,
          skillWeight
        );
      }

      function updateBars(
        partners,
        totalCash,
        skillTotals,
        grandSkillTotal,
        skillWeight
      ) {
        const container = document.getElementById("barsContainer");
        // Re-render bars (safe to re-render these as they are not inputs)
        container.innerHTML = partners
          .map((p) => {
            let cashShare = totalCash > 0 ? p.cash / totalCash : 0;
            let skillShare =
              grandSkillTotal > 0 ? skillTotals[p.id] / grandSkillTotal : 0;

            let cashPoints = cashShare * config.capitalWeight;
            let skillPoints = skillShare * skillWeight;
            let total = cashPoints + skillPoints;

            return `
                    <div>
                        <div class="flex justify-between text-sm font-bold mb-1 font-mono">
                            <span>${p.name}</span>
                            <span class="text-blue-700">${total.toFixed(
                              1
                            )}%</span>
                        </div>
                        <div class="w-full border-2 border-black h-6 flex bg-gray-100">
                            <div class="bg-green-500 h-full" style="width: ${cashPoints.toFixed(
                              2
                            )}%" title="Cash Points"></div>
                            <div class="bg-black h-full" style="width: ${skillPoints.toFixed(
                              2
                            )}%" title="Skill Points"></div>
                        </div>
                         <div class="flex justify-between text-[10px] text-gray-500 font-mono mt-1">
                            <span>Cash: ${cashPoints.toFixed(1)}</span>
                            <span>Skill: ${skillPoints.toFixed(1)}</span>
                        </div>
                    </div>
                `;
          })
          .join("");
      }

      // --- 2. Structure Management (Rebuilds DOM) ---
      // Only call this when adding/removing partners or factors

      function rebuildTableStructure() {
        const headerRow = document.getElementById("tableHeaderRow");
        const tbody = document.getElementById("matrixBody");

        // A. Headers
        let headerHTML = `
                <th class="w-48 bg-black text-white px-4 text-left">Partner</th>
                <th class="w-40 bg-green-50 text-green-900 border-green-800">
                    Capital ($)<br>
                    <span class="text-[10px] opacity-70">Real Amount</span>
                </th>
            `;

        factors.forEach((f) => {
          headerHTML += `
                <th class="w-24 text-sm">
                    ${f.name}<br>
                    <span class="text-[9px] text-gray-500">Weight: ${f.weight}</span>
                </th>`;
        });

        headerHTML += `
                <th class="w-24 bg-gray-100">Cash Pts<br><span id="headerCashPts" class="text-[10px] text-gray-500"></span></th>
                <th class="w-24 bg-gray-100">Skill Pts<br><span id="headerSkillPts" class="text-[10px] text-gray-500"></span></th>
                <th class="w-32 bg-blue-600 text-white text-lg">Equity %</th>
                <th class="w-12"></th>
            `;
        headerRow.innerHTML = headerHTML;

        // B. Body Rows
        tbody.innerHTML = partners
          .map((p) => {
            // Generate Skill Inputs
            const skillInputs = factors
              .map(
                (f) => `
                    <td class="p-1">
                        <input type="number" min="0" max="10" step="0.5"
                        value="${p.scores[f.id] || 0}" 
                        oninput="handleSkillInput('${p.id}', '${
                  f.id
                }', this.value)"
                        class="brutalist-input text-center h-full border-gray-300 focus:border-black text-sm">
                    </td>
                `
              )
              .join("");

            return `
                    <tr class="hover:bg-gray-50 group">
                        <td class="p-1">
                            <input type="text" value="${p.name}" 
                            oninput="handleNameInput('${p.id}', this.value)" 
                            class="brutalist-input border-0 bg-transparent h-full font-bold text-black">
                        </td>
                        <td class="p-1 bg-green-50">
                            <input type="number" step="100" value="${p.cash}" 
                            oninput="handleCashInput('${p.id}', this.value)" 
                            class="cash-input brutalist-input text-center h-full bg-transparent">
                        </td>
                        ${skillInputs}
                        
                        <td class="bg-gray-50 font-mono font-bold text-gray-500 text-sm" id="res-cash-${p.id}">0</td>
                        <td class="bg-gray-50 font-mono font-bold text-gray-500 text-sm" id="res-skill-${p.id}">0</td>
                        <td class="bg-blue-600 text-white font-black text-xl font-mono" id="res-equity-${p.id}">0%</td>
                        
                        <td class="text-center">
                            <button onclick="removePartner('${p.id}')" class="brutalist-btn danger">X</button>
                        </td>
                    </tr>
                `;
          })
          .join("");
      }

      // --- 3. Input Handlers (Update Data & Recalc Only) ---

      function handleNameInput(id, val) {
        const p = partners.find((x) => x.id === id);
        if (p) p.name = val;
        updateCalculationsOnly(); // Update names in bars
      }

      function handleCashInput(id, val) {
        const p = partners.find((x) => x.id === id);
        if (p) p.cash = parseFloat(val) || 0;
        updateCalculationsOnly();
      }

      function handleSkillInput(pId, fId, val) {
        const p = partners.find((x) => x.id === pId);
        if (p) p.scores[fId] = parseFloat(val) || 0;
        updateCalculationsOnly();
      }

      // --- 4. Add/Remove Helpers ---

      function renderFactorsList() {
        const container = document.getElementById("factorsList");
        container.innerHTML = factors
          .map(
            (f) => `
                <div class="flex gap-2 items-center">
                    <button onclick="removeFactor('${f.id}')" class="text-red-600 font-bold px-2 border border-red-200 hover:bg-red-50">✕</button>
                    <input type="text" value="${f.name}" onchange="updateFactorData('${f.id}', 'name', this.value)" class="brutalist-input text-sm py-2 border-gray-300">
                    <input type="number" value="${f.weight}" onchange="updateFactorData('${f.id}', 'weight', this.value)" class="brutalist-input w-20 text-center text-sm py-2 bg-gray-100" title="Weight">
                </div>
            `
          )
          .join("");
        // After changing factor list, we must rebuild structure
      }

      function addFactor() {
        const id = "f" + Date.now();
        factors.push({ id, name: "New Skill", weight: 20 });
        partners.forEach((p) => (p.scores[id] = 0));
        renderFactorsList();
        rebuildTableStructure();
        updateCalculationsOnly();
      }

      function removeFactor(id) {
        factors = factors.filter((f) => f.id !== id);
        renderFactorsList();
        rebuildTableStructure();
        updateCalculationsOnly();
      }

      function updateFactorData(id, field, val) {
        const f = factors.find((x) => x.id === id);
        if (field === "weight") f.weight = parseFloat(val) || 0;
        if (field === "name") f.name = val;
        rebuildTableStructure(); // Need to update headers
        updateCalculationsOnly();
      }

      function addPartner() {
        const id = "p" + Date.now();
        const scores = {};
        factors.forEach((f) => (scores[f.id] = 0));
        partners.push({ id, name: "New Partner", cash: 0, scores });
        rebuildTableStructure();
        updateCalculationsOnly();
      }

      function removePartner(id) {
        partners = partners.filter((p) => p.id !== id);
        rebuildTableStructure();
        updateCalculationsOnly();
      }

      // Start
      init();
    </script>
  </body>
</html>
